%Defining function for the discretization
%ysurf(end)
function u = dyneqn(t,y,yp,N,iapp,Rpp, Dp)

u = zeros(N+2,1); 
%cathode equations
u(1)=y(2)-y(1);
for i=2:N+1 % Starts at 2 and goes to Nx+1 for internal nodes 
    u(i)=yp(i)-Dp/Rpp^2*(2/((i-1)*(1/(N+1)))*(y(i)-y(i-1))/(1/(N+1))+(y(i+1)-2*y(i)+y(i-1))/(1/(N+1))^2);
end
u(N+2)=-(y(N+2)-y(N+1))/(1/(N+1))-(iapp);
% %Anode equations
% res(2*N+1)=y(2*N+1)-y(2*N + 2); % starts at 2Nx+1 
% for i=2*N+2:(2*N+3)
%     res(i)=yp(i)-Dn/Rpn^2*(2/((i-1)*h)*(y(i+1)-y(i))/h+(y(i+1)-2*y(i)+y(i-1))/h^2);
% end
% res(2*(N+2))=(y(2*(x+2))-y(2*(N+2)-1))/h+(deltan);
% %OCV Expression
% res(2*(N+2)+1)=y(2*(N+2)+1)-(9.41894182550-20.8089294802*y(N+2)+26.0321098756*y(N+2)^2-11.2415464828*y(N+2)^3-292.586540767*(y(N+2)-.96)^2*(1/2*tanh(1000*y(N+2)+1000)+1/2*tanh(1000*y(N+2)-960.00))...
%     -.212804379260*(y(N+2)-.733)^3*(1-1/2*tanh(1000*y(N+2)+1000)-1/2*tanh(1000*y(N+2)-733.000))+125.437252178*(y(N+2)-.575)^3*(1-1/2*tanh(1000*y(N+2)+1000)-1/2*tanh(1000*y(N+2)-575.000))...
%     -198.413506247*(y(N+2)-.535)^3*(1-1/2*tanh(1000*y(N+2)+1000)-1/2*tanh(1000*y(N+2)-535.000))+164.029238273*(y(N+2)-.466)^3*(1-1/2*tanh(1000*y(N+2))-1/2*tanh(1000*y(N+2)-466.000)));
% 
% res(2*(N+2)+2)=y(2*(N+2)+2)-(0.7222+0.1387*y(2*(N+2))+0.029*y(2*(N+2))^(1/2)-0.0172./y(2*(N+2))+0.0019./y(2*(N+2))^1.5+0.2808*exp(0.9-15*y(2*(N+2)))-0.7984*exp(0.4465*y(2*(N+2))-0.4108));
% 
% end
